<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <!-- إعدادات العرض لجميع الشاشات وخاصة الساعات الذكية والهواتف -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>أدعية القنوت</title>
    <style>
        /* المتغيرات الأساسية للألوان */
        :root {
            --bg-color: #ffffff;
            --text-color: #111111;
            --toolbar-bg: rgba(255, 255, 255, 0.9);
            --btn-color: #333333;
            --btn-bg: #f0f0f0;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif, 'Arial';
            transition: background-color 0.4s ease, color 0.4s ease;
            -webkit-tap-highlight-color: transparent; /* إخفاء وميض اللمس في الهواتف */
        }

        /* شريط الأدوات العائم */
        #toolbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--toolbar-bg);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            padding: 10px 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: background-color 0.4s ease;
        }

        /* أزرار التحكم */
        .control-btn {
            background-color: var(--btn-bg);
            color: var(--btn-color);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            transition: transform 0.1s, background-color 0.3s;
            user-select: none;
        }

        .control-btn:active {
            transform: scale(0.9);
        }

        .control-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        /* حاوية النص */
        #content {
            padding: 80px 15px 30px; /* مسافة علوية لتجنب تغطية شريط الأدوات */
            max-width: 800px;
            margin: 0 auto;
            text-align: justify;
            line-height: 1.8;
            font-size: 50px; /* الحجم الافتراضي أصبح الحد الأقصى */
            transition: font-size 0.3s ease;
        }

        h1 {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 30px;
            color: #c0392b;
        }

        /* تخصيص الثيمات */
        body.theme-light {
            --bg-color: #ffffff;
            --text-color: #111111;
            --toolbar-bg: rgba(255, 255, 255, 0.9);
            --btn-color: #111;
            --btn-bg: #f0f0f0;
        }
        
        body.theme-sepia {
            --bg-color: #f4ecd8;
            --text-color: #5b4636;
            --toolbar-bg: rgba(244, 236, 216, 0.9);
            --btn-color: #5b4636;
            --btn-bg: #e3d9c0;
        }

        body.theme-dark {
            --bg-color: #1e1e2e;
            --text-color: #cdd6f4;
            --toolbar-bg: rgba(30, 30, 46, 0.9);
            --btn-color: #cdd6f4;
            --btn-bg: #313244;
        }

        body.theme-oled {
            --bg-color: #000000;
            --text-color: #e0e0e0;
            --toolbar-bg: rgba(0, 0, 0, 0.85);
            --btn-color: #fff;
            --btn-bg: #222222;
        }
        
        body.theme-dark h1, body.theme-oled h1 { color: #ff8a80; }
        body.theme-sepia h1 { color: #8d6e63; }

        /* تأثير التحميل */
        .spinner {
            border: 4px solid var(--btn-bg);
            border-left-color: var(--btn-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* تعديلات مخصصة لشاشات الساعات الذكية (أقل من 320 بكسل) */
        @media screen and (max-width: 320px) {
            #toolbar {
                padding: 5px;
                gap: 5px;
            }
            .control-btn {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }
            .control-btn svg { width: 18px; height: 18px; }
            #content {
                padding-top: 60px;
                padding-left: 10px;
                padding-right: 10px;
                line-height: 1.6;
            }
        }
    </style>
</head>
<body class="theme-light">

    <!-- شريط الأدوات -->
    <div id="toolbar">
        <!-- تكبير الخط -->
        <button class="control-btn" onclick="zoomIn()" title="تكبير النص">A+</button>
        <!-- تصغير الخط -->
        <button class="control-btn" onclick="zoomOut()" title="تصغير النص">A-</button>
        <!-- تبديل الوضع الليلي / النهاري -->
        <button class="control-btn" onclick="toggleDayNight()" title="الوضع الليلي/النهاري">
            <svg viewBox="0 0 24 24"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg>
        </button>
        <!-- تبديل لون الخلفية -->
        <button class="control-btn" onclick="cycleTheme()" title="تغيير لون الخلفية">
            <svg viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
        </button>
    </div>

    <!-- محتوى النص -->
    <div id="content">
        <div id="loading" style="text-align: center; margin-top: 50px;">
            <div class="spinner"></div>
            <p>جاري جلب أحدث نص من مستند جوجل...</p>
        </div>
    </div>

    <script>
        // إعدادات حجم الخط
        let currentFontSize = 50; // الحجم الابتدائي أصبح الحد الأقصى
        const contentDiv = document.getElementById('content');
        const minFontSize = 14; // الحد الأدنى
        const maxFontSize = 50; // الحد الأقصى

        function zoomIn() {
            if (currentFontSize < maxFontSize) {
                currentFontSize += 2;
                contentDiv.style.fontSize = currentFontSize + 'px';
            }
        }

        function zoomOut() {
            if (currentFontSize > minFontSize) {
                currentFontSize -= 2;
                contentDiv.style.fontSize = currentFontSize + 'px';
            }
        }

        // إعدادات الثيمات والألوان
        const themes = ['theme-light', 'theme-sepia', 'theme-dark', 'theme-oled'];
        let currentThemeIndex = 0;

        function cycleTheme() {
            document.body.classList.remove(themes[currentThemeIndex]);
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            document.body.classList.add(themes[currentThemeIndex]);
        }

        function toggleDayNight() {
            document.body.classList.remove(themes[currentThemeIndex]);
            // إذا كان الوضع حالياً فاتحاً (أبيض أو بني)، حوله لأسود غامق (OLED) المريح جداً للساعات الذكية
            if (currentThemeIndex === 0 || currentThemeIndex === 1) {
                currentThemeIndex = 3; // OLED (أسود)
            } else {
                currentThemeIndex = 0; // Light (أبيض)
            }
            document.body.classList.add(themes[currentThemeIndex]);
        }

        // جلب النص الديناميكي من مستند جوجل
        async function loadContent() {
            const docId = '1rtqMA2bRaezFcqbMwAEWAwX4ZrBEsKvFnjrFg6KbS4Q';
            // رابط تصدير الملف كنص من جوجل درايف
            const exportUrl = `https://docs.google.com/document/export?format=txt&id=${docId}`;
            // استخدام بروكسي عام لتجاوز حماية المتصفح (CORS) والسماح بقراءة الملف
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(exportUrl)}`;

            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error('فشل الاتصال بالخادم');
                
                const text = await response.text();
                
                // التأكد من أن الملف عام وليس صفحة تسجيل دخول
                if (text.includes('<!DOCTYPE html>')) {
                    throw new Error('يرجى التأكد من أن إعدادات مشاركة المستند هي "أي شخص لديه الرابط".');
                }

                // تحويل النص إلى فقرات HTML
                const paragraphs = text.split('\n')
                                       .map(p => p.trim())
                                       .filter(p => p.length > 0)
                                       .map(p => `<p>${p}</p>`)
                                       .join('');

                document.getElementById('content').innerHTML = `<h1>مختارات من دعاء القنوت</h1>${paragraphs}`;
                
            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div style="text-align:center; margin-top:50px;">
                        <h3 style="color:#c0392b;">عذراً، حدث خطأ أثناء جلب النص</h3>
                        <p>${error.message}</p>
                        <button class="control-btn" style="width:auto; padding:0 20px; border-radius:20px; margin:20px auto;" onclick="loadContent()">إعادة المحاولة</button>
                    </div>
                `;
            }
        }

        // تشغيل دالة الجلب عند اكتمال تحميل الصفحة
        window.addEventListener('DOMContentLoaded', loadContent);
    </script>
</body>
</html>
